import{r as s,d as e,h as t,H as i}from"./p-76bbd7fc.js";import"./p-efed8a23.js";import{V as a}from"./p-627d7603.js";import{j as o}from"./p-e10b421b.js";const n=o.object({email:o.string().email({tlds:{allow:!1}}).min(5).max(128).lowercase().trim().required()}),r=o.object({code_ResetPassword:o.number().required().min(1e3).max(9999),email:o.string().email({tlds:{allow:!1}}).min(5).max(128).lowercase().trim().required(),password_New:o.string().trim().min(8).required(),password_New_Repeat:o.string().equal(o.ref("password_New")).trim().required()});let d=class{constructor(i){s(this,i),this.event_RouteTo=e(this,"event_RouteTo",7),this.email="",this.code_ResetPassword=-1,this.password_New="",this.password_New_Repeat="",this.wizard_Steps=["init","confirm"],this.wizard_CurrentStep=0,this.state=this.wizard_Steps[this.wizard_CurrentStep],this.isActive_SendResetCode_Button=!1,this.isActive_ConfirmPassword_Button=!1,this.handle_Submit_SendResetCode=async()=>{let s={email:this.email.trim().toLowerCase()},{isValid_SendResetCode_Inputs:e,message_Validate_SendResetCode_Inputs:t}=(s=>{let{error:e}=n.validate(s);return e?{isValid_SendResetCode_Inputs:!1,message_Validate_SendResetCode_Inputs:e.details[0].message}:{isValid_SendResetCode_Inputs:!0,message_Validate_SendResetCode_Inputs:""}})(s);if(!e)return alert(t);this.isActive_SendResetCode_Button=!0;let{isSuccess_SendResetCode_Inputs_Submission:i,message_SendResetCode_Inputs_Submission:o,payload_SendResetCode_Inputs_Submission:r}=await(async s=>{let e,t=!1,i=`${a.api.url}/${a.api.endpoint.send_PasswordResetCode}`,o={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)};return await fetch(i,o).then((s=>s.json())).then((s=>{e=s,t=e.success})).catch((s=>{console.log(s)})),t?{isSuccess_SendResetCode_Inputs_Submission:!0,message_SendResetCode_Inputs_Submission:"Password reset code sent",payload_SendResetCode_Inputs_Submission:e}:{isSuccess_SendResetCode_Inputs_Submission:!1,message_SendResetCode_Inputs_Submission:"Failed to send password reset code",payload_SendResetCode_Inputs_Submission:{}}})(s);return this.isActive_SendResetCode_Button=!1,i?r.success?(alert(r.message),this.wizard_CurrentStep=this.wizard_CurrentStep+1,void(this.state=this.wizard_Steps[this.wizard_CurrentStep])):alert(r):alert(o)},this.handle_Confirm_Password=async()=>{let s=(e=this.password_New,t=this.password_New_Repeat,i=this.code_ResetPassword,{email:this.email.trim().toLowerCase(),password_New:e,password_New_Repeat:t,code_ResetPassword:i});var e,t,i;let{isValid_ConfirmPassword_Inputs:o,message_Validate_ConfirmPassword_Inputs:n}=(s=>{let{error:e}=r.validate(s);return e?{isValid_ConfirmPassword_Inputs:!1,message_Validate_ConfirmPassword_Inputs:e.details[0].message}:{isValid_ConfirmPassword_Inputs:!0,message_Validate_ConfirmPassword_Inputs:""}})(s);if(!o)return alert(n);this.isActive_ConfirmPassword_Button=!0;let{isSuccess_ConfirmPassword_Inputs_Submission:d,message_ConfirmPassword_Inputs_Submission:l,payload_ConfirmPassword_Inputs_Submission:_}=await(async s=>{let e,t=!1,i=`${a.api.url}/${a.api.endpoint.confirm_Password}`,o={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(s)};return await fetch(i,o).then((s=>s.json())).then((s=>{e=s,t=e.success})).catch((s=>{console.log(s)})),t?{isSuccess_ConfirmPassword_Inputs_Submission:!0,message_ConfirmPassword_Inputs_Submission:e.message,payload_ConfirmPassword_Inputs_Submission:e}:{isSuccess_ConfirmPassword_Inputs_Submission:!1,message_ConfirmPassword_Inputs_Submission:e.message,payload_ConfirmPassword_Inputs_Submission:{}}})(s);if(this.isActive_ConfirmPassword_Button=!1,!d)return alert(l);alert(`${_.message}. Proceed to login`),this.event_RouteTo.emit({type:"push",route:"/login",data:{}})},this.Init=()=>t("div",null,t("e-text",{variant:"display"},"Forgot Password"),t("e-text",{variant:"footnote"},t("strong",null,"STEP 1 of 2 - EMAIL VERIFICATION")),t("l-spacer",{value:1}),t("l-seperator",null),t("l-spacer",{value:1}),t("e-text",null,"Enter your email. You will receive a 4-digit password reset code"),t("l-spacer",{value:2}),t("e-input",{type:"email",name:"email",placeholder:"Email"}),t("l-spacer",{value:2}),t("l-row",{justifyContent:"space-between"},t("e-text",{variant:"footnote"},t("e-link",{action:"goBack",event:!0},"< Back")),t("e-button",{action:"send_ResetCode",active:this.isActive_SendResetCode_Button},"Send reset code"))),this.Confirm=()=>t("div",null,t("e-text",{variant:"display"},"Forgot Password"),t("e-text",{variant:"footnote"},t("strong",null,"STEP 2 of 2 - PASSWORD RESET")),t("l-spacer",{value:1}),t("l-seperator",null),t("l-spacer",{value:1}),t("e-text",null,"Enter reset code & new password"),t("l-spacer",{value:1}),t("e-input",{type:"number",name:"code_ResetPassword",placeholder:"4-digit reset code (check inbox)"}),t("l-spacer",{value:2}),t("e-input",{type:"password",name:"password_New",placeholder:"New password (min 8 chars)"}),t("l-spacer",{value:2}),t("e-input",{type:"password",name:"password_New_Repeat",placeholder:"Repeat new password"}),t("l-spacer",{value:2}),t("l-row",{justifyContent:"space-between"},t("e-text",{variant:"footnote"},t("e-link",{action:"goBack",event:!0},"< Back")),t("e-button",{action:"confirm_Password",active:this.isActive_ConfirmPassword_Button},"Confirm")))}handle_TextInput(s){"email"===s.detail.name?this.email=s.detail.value:"code_ResetPassword"===s.detail.name?this.code_ResetPassword=s.detail.value:"password_New"===s.detail.name?this.password_New=s.detail.value:"password_New_Repeat"===s.detail.name&&(this.password_New_Repeat=s.detail.value)}handle_ButtonClick(s){"send_ResetCode"===s.detail.action?this.handle_Submit_SendResetCode():"confirm_Password"===s.detail.action&&this.handle_Confirm_Password()}handle_LinkClick(s){if("goBack"===s.detail.action){if(this.state===this.wizard_Steps[this.wizard_Steps.length-1])return this.wizard_CurrentStep=this.wizard_CurrentStep-1,void(this.state=this.wizard_Steps[this.wizard_CurrentStep]);this.event_RouteTo.emit({type:"goBack"})}}render(){return t(i,null,t("c-card",null,this.state===this.wizard_Steps[0]&&t(this.Init,null),this.state===this.wizard_Steps[1]&&t(this.Confirm,null)))}};d.style=":host{display:block;width:30%;margin:0 auto;padding-top:6em}";export{d as v_forgot_password}