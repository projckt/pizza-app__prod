import{r as t,d as e,h as i,H as s}from"./p-76bbd7fc.js";import{i as n}from"./p-9327ba3c.js";import"./p-efed8a23.js";import{V as a}from"./p-627d7603.js";import"./p-d4a71799.js";var r="https://js.stripe.com/v3",l=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,o="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",c=null,u=function(t,e,i){if(null===t)return null;var s=t.apply(void 0,e);return function(t,e){t&&t._registerWrapper&&t._registerWrapper({name:"stripe-js",version:"1.53.0",startTime:e})}(s,i),s},d=Promise.resolve().then((function(){return t=null,null!==c?c:c=new Promise((function(e,i){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&t&&console.warn(o),window.Stripe)e(window.Stripe);else try{var s=function(){for(var t=document.querySelectorAll('script[src^="'.concat(r,'"]')),e=0;e<t.length;e++){var i=t[e];if(l.test(i.src))return i}return null}();s&&t?console.warn(o):s||(s=function(t){var e=t&&!t.advancedFraudSignals?"?advancedFraudSignals=false":"",i=document.createElement("script");i.src="".concat(r).concat(e);var s=document.head||document.body;if(!s)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return s.appendChild(i),i}(t)),s.addEventListener("load",(function(){window.Stripe?e(window.Stripe):i(new Error("Stripe.js not available"))})),s.addEventListener("error",(function(){i(new Error("Failed to load Stripe.js"))}))}catch(t){return void i(t)}else e(null)}));var t})),h=!1;d.catch((function(t){h||console.warn(t)}));let p=class{constructor(s){t(this,s),this.event_RouteTo=e(this,"event_RouteTo",7),this.isFetched_ViewData=!1,this.isActive_ConfirmAndPay_Button=!1,this.isDisabled_ConfirmAndPay_Button=!0,this.id_Document="",this.title_Publication="",this.edition_Publication="",this.title_Document="",this.price_Currency="",this.price_Value=0,this.fee_Processing_Gateway=0,this.stripe_Key_Public="",this.ui_Skel_Lines=()=>i("div",null,i("l-spacer",{value:1}),i("div",{class:"skel__line"}),i("l-spacer",{value:1}),i("div",{class:"skel__line"}),i("l-spacer",{value:1}),i("div",{class:"skel__line"}),i("l-spacer",{value:1})),this.ui_Details=()=>i("div",null,i("e-text",{variant:"subHeading"},this.title_Publication),i("e-text",null,this.edition_Publication),i("l-spacer",{value:.5}),i("l-seperator",null)),this.ui_Summary=()=>i("div",null,i("e-text",{variant:"subHeading"},"Item:"),i("e-text",null,this.title_Document),i("l-spacer",{value:1}),i("table",null,i("tr",null,i("td",null,"Item cost"),i("td",null,this.price_Currency,this.price_Value)),i("tr",null,i("td",null,"Processing fees"),i("td",null,this.price_Currency,this.fee_Processing_Gateway)),i("tr",null,i("td",null,i("strong",null,"Grand total")),i("td",null,i("strong",null,this.price_Currency,this.price_Value+this.fee_Processing_Gateway)))))}handle_LinkClick(t){"goBack"===t.detail.action&&this.event_RouteTo.emit({type:"goBack"})}handle_ButtonClick(t){"action_Create_CheckoutSession"===t.detail.action&&this.create_Checkout_Session()}componentWillLoad(){this.match.params.id_Document||this.event_RouteTo.emit({type:"push",route:"/store",data:{}}),this.id_Document=this.match.params.id_Document.trim()}componentDidLoad(){this.fetch_ViewData()}async fetch_ViewData(){let t={id_Document:this.id_Document},{success:e,message:i,payload:s}=await(async t=>{let e,i=`${a.api.url}/${a.api.endpoint.document.checkout}`,s={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)};return await fetch(i,s).then((t=>t.json())).then((t=>{e=t})).catch((t=>{console.log(t)})),{success:e.success,message:e.message,payload:e.payload}})(t);if(!e)return alert(i),void this.event_RouteTo.emit({type:"push",route:"/store",data:{}});this.data_Document=s,this.init_ViewData(),this.init_Stripe(),this.isFetched_ViewData=!0}init_ViewData(){this.title_Document=this.data_Document.title_Document,this.title_Publication=this.data_Document.title_Publication,this.edition_Publication=this.data_Document.edition_Publication,this.price_Currency=this.data_Document.price.currency,this.price_Value=this.data_Document.price.value,this.fee_Processing_Gateway=this.data_Document.gateway.processing_fee,this.stripe_Key_Public=this.data_Document.gateway.stripe_Key_Public}async init_Stripe(){this.stripe=await function(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];h=!0;var s=Date.now();return d.then((function(t){return u(t,e,s)}))}(this.stripe_Key_Public),this.isDisabled_ConfirmAndPay_Button=!1}async create_Checkout_Session(){let t={id_Document:this.id_Document};this.isActive_ConfirmAndPay_Button=!0;let{success:e,message:i,payload:s}=await(async t=>{let e,i=`${a.api.url}/${a.api.endpoint.stripe.create_Checkout_Session}`,s={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(t)};return await fetch(i,s).then((t=>t.json())).then((t=>{e=t})).catch((t=>{console.log(t)})),{success:e.success,message:e.message,payload:e.payload}})(t);if(this.isActive_ConfirmAndPay_Button=!1,!e)return alert(i);const{error:n}=await this.stripe.redirectToCheckout({sessionId:s});console.warn(n.message)}render(){return i(s,null,i("c-card",null,this.isFetched_ViewData?i("div",null,i(this.ui_Details,null),i("l-spacer",{value:.25}),i(this.ui_Summary,null),i("l-spacer",{value:.5}),i("e-text",{variant:"footnote"},"Item cost includes GST")):i("div",null,i(this.ui_Skel_Lines,null),i("l-spacer",{value:2}),i(this.ui_Skel_Lines,null)),i("l-spacer",{value:2}),i("l-row",{justifyContent:"space-between"},i("e-text",{variant:"footnote"},i("e-link",{action:"goBack",event:!0},"< Back")),i("e-button",{action:"action_Create_CheckoutSession",disabled:this.isDisabled_ConfirmAndPay_Button,active:this.isActive_ConfirmAndPay_Button},"Confirm & pay"))))}};n(p),p.style=":host{display:flex;align-items:center;justify-content:space-around;padding-top:6em}c-card{width:25%}.article__container{width:100%;height:150px;background:wheat;border-radius:var(--site-border-radius)}input[type='radio']:hover{cursor:pointer}table{border-collapse:collapse;width:100%;border-radius:0.5em}table,td{border:1px solid var(--grey-lightest);text-align:left}th,td{padding:0.5em 0.5em}.skel__line{height:10px;border-radius:0.25em;background:#ccc;background-image:linear-gradient(90deg, #f4f4f4 0px, rgba(229, 229, 229, 0.8) 40%, #f4f4f4 100%);background-size:200%;animation:skel-shine 1s infinite ease-out}@keyframes skel-shine{0%{background-position:-100px}40%,100%{background-position:140px}}";export{p as v_checkout}