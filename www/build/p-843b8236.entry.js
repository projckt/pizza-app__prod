import{r as e,d as i,h as t,H as a}from"./p-76bbd7fc.js";import{s as l}from"./p-efed8a23.js";import{V as n}from"./p-627d7603.js";import{j as s}from"./p-e10b421b.js";const o=s.object({email:s.string().email({tlds:{allow:!1}}).min(5).max(128).lowercase().trim().required()}),r=s.object({email:s.string().email({tlds:{allow:!1}}).min(5).max(128).lowercase().trim().required(),code_EmailVerification:s.number().min(1e3).max(9999).required()});let d=class{constructor(a){e(this,a),this.event_RouteTo=i(this,"event_RouteTo",7),this.isFetched_ViewData=!1,this.code_EmailVerification=0,this.data_Readings=[],this.isActive_ResendVerificationCode_Button=!1,this.Banner_EmailVerification=()=>t("c-banner",{theme:"danger"},t("l-row",{justifyContent:"space-between"},t("l-row",null,t("e-text",null,"Enter your email verification code"),t("l-spacer",{variant:"horizontal",value:.5}),t("e-input",{type:"number",name:"code_EmailVerification",placeholder:"4-digit code"})),t("e-button",{action:"action_ReSend_EmailVerificationCode",active:this.isActive_ResendVerificationCode_Button},"Re-send code"))),this.LeftPanel=()=>t("div",{class:"left-panel"},t("header",null,t("e-text",{variant:"heading"},"Aitihya"),t("e-text",null,"Digital Library"),t("l-spacer",{value:4}),t("e-link",{variant:"navLink_Active",action:"myLibrary",event:!0},t("l-row",null,t("ion-icon",{name:"book-outline"}),t("l-spacer",{variant:"horizontal",value:.25}),t("e-text",null,"My Library"))),t("l-spacer",{value:.5}),t("e-link",{variant:"navLink",action:"store",event:!0},t("l-row",null,t("ion-icon",{name:"cart-outline"}),t("l-spacer",{variant:"horizontal",value:.25}),t("e-text",null,"Store"))),t("l-spacer",{value:1})),t("footer",null,t("p-user-control",null))),this.RightPanel=()=>t("div",{class:"right-panel"},l.account_Email&&!l.isVerified_AccountEmail&&t("div",null,t("l-spacer",{value:2}),t(this.Banner_EmailVerification,null)),t("l-spacer",{value:2}),t("e-text",{variant:"subHeading",theme:"light-grey"},t("l-row",null,t("ion-icon",{name:"book"}),t("l-spacer",{variant:"horizontal",value:.25}),"My library")),t("l-spacer",{value:1}),t("l-seperator",null),t("l-spacer",{value:2}),t(this.isFetched_ViewData?this.ui_Gallery:this.ui_Skel,null)),this.ui_Skel=()=>t("e-list",null,t("e-list-item",null,t("p-publication",{isSkel:!0})),t("e-list-item",null,t("p-publication",{isSkel:!0})),t("e-list-item",null,t("p-publication",{isSkel:!0}))),this.ui_Gallery=()=>this.data_Readings.length>0?t("e-list",null,this.data_Readings.map((e=>t("e-list-item",null,t("p-reading",{id:e.id,title:e.publication.title,edition:e.publication.edition,document:e.title}))))):t("e-text",null,"Your library is empty. Please visit"," ",t("e-link",{action:"store",event:!0},"our store")," ","to buy journals")}handle_ButtonClick(e){"goToReader"===e.detail.action?this.event_RouteTo.emit({type:"push",route:`/reader/${e.detail.value}`}):"action_ReSend_EmailVerificationCode"===e.detail.action&&this.handle_Submit_ReSend_EmailVerificationCode()}handle_LinkClick(e){"store"===e.detail.action&&this.event_RouteTo.emit({type:"push",route:"/store",data:{}})}handle_TextInput(e){"code_EmailVerification"===e.detail.name&&(this.code_EmailVerification=e.detail.value,this.handle_Input_EmailVerification_Code())}componentDidLoad(){this.fetch_ViewData()}async fetch_ViewData(){let{success:e,message:i,payload:t}=await(async()=>{let e,i=`${n.api.url}/${n.api.endpoint.library}`;return await fetch(i,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then((e=>e.json())).then((i=>{e=i})).catch((e=>{console.log(e)})),{success:e.success,message:e.message,payload:e.payload}})();if(!e)return this.isFetched_ViewData=!0,alert(i);this.data_Readings=t,this.isFetched_ViewData=!0}async handle_Submit_ReSend_EmailVerificationCode(){this.isActive_ResendVerificationCode_Button=!0;let e={email:l.account_Email.trim().toLowerCase()},{isValid_ReSend_EmailVerificationCode_Inputs:i,message_Validate_ReSend_EmailVerificationCode_Inputs:t}=(e=>{let{error:i}=o.validate(e);return i?{isValid_ReSend_EmailVerificationCode_Inputs:!1,message_Validate_ReSend_EmailVerificationCode_Inputs:i.details[0].message}:{isValid_ReSend_EmailVerificationCode_Inputs:!0,message_Validate_ReSend_EmailVerificationCode_Inputs:""}})(e);if(!i)return alert(t);this.isActive_ResendVerificationCode_Button=!0;let{success:a,message:s}=await(async e=>{let i,t=`${n.api.url}/${n.api.endpoint.reSend_EmailVerificationCode}`,a={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)};return await fetch(t,a).then((e=>e.json())).then((e=>{i=e})).catch((e=>{console.log(e)})),{success:i.success,message:i.message,payload:i.payload}})(e);if(this.isActive_ResendVerificationCode_Button=!1,!a)return alert(s);alert(s)}handle_Input_EmailVerification_Code(){4===this.code_EmailVerification.toString().length&&this.handle_Submit_EmailVerification_Code()}async handle_Submit_EmailVerification_Code(){let e=(i=this.code_EmailVerification,{email:l.account_Email.trim().toLowerCase(),code_EmailVerification:i});var i;let{isValid_Submit_EmailVerificationCode_Inputs:t,message_Validate_Submit_EmailVerificationCode_Inputs:a}=(e=>{let{error:i}=r.validate(e);return i?{isValid_Submit_EmailVerificationCode_Inputs:!1,message_Validate_Submit_EmailVerificationCode_Inputs:i.details[0].message}:{isValid_Submit_EmailVerificationCode_Inputs:!0,message_Validate_Submit_EmailVerificationCode_Inputs:""}})(e);if(!t)return alert(a);let{success:s,message:o}=await(async e=>{let i,t=`${n.api.url}/${n.api.endpoint.submit_EmailVerificationCode}`,a={method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)};return await fetch(t,a).then((e=>e.json())).then((e=>{i=e})).catch((e=>{console.log(e)})),{success:i.success,message:i.message,payload:i.payload}})(e);if(!s)return alert(o);l.isVerified_AccountEmail=!0,alert(o)}render(){return t(a,null,t(this.LeftPanel,null),t(this.RightPanel,null))}};d.style=":host{display:flex;width:100%}.left-panel{display:flex;flex-direction:column;justify-content:space-between;box-sizing:border-box;width:18%;height:100vh;padding:1em;position:fixed;border-right:1px solid var(--grey-lightest)}.right-panel{box-sizing:border-box;width:82%;height:100vh;margin-left:22.5%;padding:0em 3em 0em 0}";export{d as v_my_library}